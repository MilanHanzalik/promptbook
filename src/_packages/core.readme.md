Core of the library, it contains the main logic for promptbooks